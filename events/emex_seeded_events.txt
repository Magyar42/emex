namespace = emex_origin2

# Set Up
event = {
	id = emex_origin2.0
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		every_playable_country = {
			limit = { has_origin = origin_emex_seeded_evolution }
			country_event = { id = emex_origin2.1 }
		}
	}
}

# Set Up
country_event = {
	id = emex_origin2.1
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_country_flag = emex_seeded_evolution_set_up_complete }
	}
	
	immediate = {
		capital_scope = { 
			# add_deposit = d_emex_luscious_fields
			add_deposit = d_emex_lost_remains
			add_deposit = d_emex_lost_remains
			add_deposit = d_emex_charred_fields
			add_deposit = d_emex_derelict_camps
			add_deposit = d_emex_seeder_workshops
		}
		begin_event_chain = {
			event_chain = emex_seeded_annals
		}
		country_event = {
			id = emex_origin2.5 # Gatekeeper event for triggering event chains
			days = 5
		}
		set_country_flag = emex_seeded_evolution_set_up_complete
	}
}

# Event Chain Gatekeeper - FIRST ONE ONLY
country_event = {
	id = emex_origin2.5
	title = "emex_origin2.5.name"
	desc = "emex_origin2.5.desc"
	picture = GFX_evt_star_chart
	
	is_triggered_only = yes
	
	trigger = {
		has_origin = origin_emex_seeded_evolution
		NOT = {
			has_country_flag = emex_seeded_ongoing_branch
		}
	}
	# todo: make the special projects appear on specific planets in solar_system_initializers
	immediate = {
		while = {
			count = 3
			random_list = {
				10 = {
					modifier = {
						factor = 0
						OR = {
							has_country_flag = emex_seeded_chain1_done
							has_country_flag = emex_seeded_chain1_available
						}
					}
					set_country_flag = emex_seeded_chain1_available
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							has_country_flag = emex_seeded_chain2_done
							has_country_flag = emex_seeded_chain2_available
						}
					}
					set_country_flag = emex_seeded_chain2_available
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							has_country_flag = emex_seeded_chain3_done
							has_country_flag = emex_seeded_chain3_available
						}
					}
					set_country_flag = emex_seeded_chain3_available
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							has_country_flag = emex_seeded_chain4_done
							has_country_flag = emex_seeded_chain4_available
						}
					}
					set_country_flag = emex_seeded_chain4_available
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							has_country_flag = emex_seeded_chain5_done
							has_country_flag = emex_seeded_chain5_available
						}
					}
					set_country_flag = emex_seeded_chain5_available
				}
				10 = {
					modifier = {
						factor = 0
						OR = {
							has_country_flag = emex_seeded_chain6_done
							has_country_flag = emex_seeded_chain6_available
						}
					}
					set_country_flag = emex_seeded_chain6_available
				}
			}
		}
	}

	after = {
		set_country_flag = emex_seeded_ongoing_branch # todo: ensure to remove at end of each event chain
	}

	# NOTE: all systems involved are SPAWNED in when the path is chosen; this is so that several "versions" of each
	# system can be present if several empires have the origin, so that the systems and which empire they were made
	# for can be tracked, ensuring empires ONLY need the systems created for them

	option = {
		name = "emex_origin2.5.1"
		trigger = {
			has_country_flag = emex_seeded_chain1_available
		}
		# Spawn related system
		capital_scope.solar_system = {
			closest_system = {
				min_steps = 2
				max_steps = 3
				spawn_system = {
					initializer = emex_seeded_path1_system
				}
			}
		}
		# Create special project
		last_created_system = {
			random_system_planet = {
				limit = {
					has_planet_flag = emex_seeder_sp1_planet
				}
				set_planet_flag = emex_seeder_sp1_planet@root
				enable_special_project = {
					name = EMEX_SEEDED_PATH1
					location = THIS
				}
			}
		}
		set_country_flag = emex_seeded_ongoing_branch_1
		remove_country_flag = emex_seeded_chain1_available
	}
	option = {
		name = "emex_origin2.5.2"
		trigger = {
			has_country_flag = emex_seeded_chain2_available
		}
		capital_scope.solar_system = {
			closest_system = {
				min_steps = 3
				limit = {
					any_system_planet = {
						is_planet_class = pc_gas_giant
					}
				}
				random_system_planet = {
					limit = {
						is_planet_class = pc_gas_giant
					}
					set_planet_flag = emex_seeder_sp2_planet
					set_planet_flag = emex_seeder_sp2_planet@root
					enable_special_project = {
						name = EMEX_SEEDED_PATH2
						location = THIS
					}
				}
			}
		}
		set_country_flag = emex_seeded_ongoing_branch_2
		remove_country_flag = emex_seeded_chain2_available
	}
	option = {
		name = "emex_origin2.5.3"
		trigger = {
			has_country_flag = emex_seeded_chain3_available
		}
		capital_scope = {
			enable_special_project = {
				name = EMEX_SEEDED_PATH3
				location = THIS
			}
		}
		set_country_flag = emex_seeded_ongoing_branch_3
		remove_country_flag = emex_seeded_chain3_available
	}
	option = {
		name = "emex_origin2.5.4"
		trigger = {
			has_country_flag = emex_seeded_chain4_available
		}
		capital_scope = {
			enable_special_project = {
				name = EMEX_SEEDED_PATH4
				location = THIS
			}
		}
		set_country_flag = emex_seeded_ongoing_branch_4
		remove_country_flag = emex_seeded_chain4_available
	}
	option = {
		name = "emex_origin2.5.5"
		trigger = {
			has_country_flag = emex_seeded_chain5_available
		}
		capital_scope = {
			enable_special_project = {
				name = EMEX_SEEDED_PATH5
				location = THIS
			}
		}
		set_country_flag = emex_seeded_ongoing_branch_5
		remove_country_flag = emex_seeded_chain5_available
	}
	option = {
		name = "emex_origin2.5.6"
		trigger = {
			has_country_flag = emex_seeded_chain6_available
		}
		capital_scope = {
			enable_special_project = {
				name = EMEX_SEEDED_PATH6
				location = THIS
			}
		}
		set_country_flag = emex_seeded_ongoing_branch_6
		remove_country_flag = emex_seeded_chain6_available
	}
}

## Path 1 - World of Grey

# Start SP Complete
ship_event = {
	id = emex_origin2.100
	title = "emex_origin2.100.name"
	desc = "emex_origin2.100.desc"
	picture = GFX_evt_gray_goo
	location = fromfrom
	
	is_triggered_only = yes
	
	trigger = {
		owner = { has_origin = origin_emex_seeded_evolution }
	}

	immediate = {
		fromfrom = {
			save_event_target_as = emex_seeder_sp1_target
		}
	}

	# after = {
	# 	clear_global_event_target = emex_seeder_sp1_planet_eventname
	# }
	
	option = {
		name = "emex_origin2.100.1"
		owner = {
			add_resource = {
				energy = -750
			}
			hidden_effect = {
				set_country_flag = emex_seeder_sp1_pathA
				country_event = {
					id = emex_origin2.101
					days = 90
					random = 30
				}
			}
		}
	}
	option = {
		name = "emex_origin2.100.2"
		allow = {
			owner = { has_resource = { type = minerals amount >= 2000} }
		}
		owner = {
			add_resource = {
				minerals = -2000
			}
			add_monthly_resource_mult = {
				resource = unity
				value = 3
				min = 750
				max = 10000
			}
			hidden_effect = {
				set_country_flag = emex_seeder_sp1_pathB
				country_event = {
					id = emex_origin2.101
					days = 60
					random = 30
				}
			}
		}
	}
}
# Nanites Removed
country_event = {
	id = emex_origin2.101
	title = "emex_origin2.101.name"
	desc = {
		trigger = {
			has_country_flag = emex_seeder_sp1_pathA
		}
		text = "emex_origin2.101.A.desc"
	}
	desc = {
		trigger = {
			has_country_flag = emex_seeder_sp1_pathB
		}
		text = "emex_origin2.101.B.desc"
	}
	picture = GFX_evt_gray_gooed_planet
	location = event_target:emex_seeder_sp1_target
	
	is_triggered_only = yes

	trigger = {
		has_origin = origin_emex_seeded_evolution
	}

	immediate = {
		event_target:emex_seeder_sp1_target = {
			change_pc = pc_barren_cold
			reroll_deposits = yes
		}
	}
	
	option = {
		name = "emex_origin2.101.1"
		event_target:emex_seeder_sp1_target = {
			add_deposit = d_alloys_2
			enable_special_project = {
				name = EMEX_SEEDED_PATH1_part2
				location = THIS
			}
		}
	}
}
# Surface Scanned
country_event = {
	id = emex_origin2.102
	title = "emex_origin2.102.name"
	desc = "emex_origin2.102.desc"
	picture = GFX_evt_storm_formation
	location = event_target:emex_seeder_sp1_target
	
	is_triggered_only = yes

	trigger = {
		has_origin = origin_emex_seeded_evolution
	}

	immediate = {
	}
	
	option = {
		name = "emex_origin2.102.1"
		hidden_effect = {
			set_country_flag = emex_seeder_sp1_part2_pathA
			country_event = {
				id = emex_origin2.103
				days = 120
				random = 30
			}
		}
	}
	option = {
		name = "emex_origin2.102.2"
		hidden_effect = {
			set_country_flag = emex_seeder_sp1_part2_pathB
			country_event = {
				id = emex_origin2.103
				days = 120
				random = 30
			}
		}
	}
}
# End Event
country_event = {
	id = emex_origin2.103
	title = "emex_origin2.103.name"
	desc = {
		trigger = {
			has_country_flag = emex_seeder_sp1_part2_pathA
		}
		text = "emex_origin2.103.A.desc"
	}
	desc = {
		trigger = {
			has_country_flag = emex_seeder_sp1_part2_pathB
		}
		text = "emex_origin2.103.B.desc"
	}
	picture = GFX_evt_derelict_interior
	location = event_target:emex_seeder_sp1_target
	
	is_triggered_only = yes

	trigger = {
		has_origin = origin_emex_seeded_evolution
	}

	immediate = {
	}
	
	option = {
		name = "emex_origin2.103.1"
		if = {
			limit = {
				has_country_flag = emex_seeder_sp1_part2_pathA
			}
			add_monthly_resource_mult = {
				resource = alloys
				value = 5
				min = 2000
				max = 8000
			}
			add_modifier = {
				modifier = emex_seeder_sp1_outcomeA
				days = 3600
			}
		}
		else = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = 12
				min = 5000
			}
			add_resource = {
				nanites = 2000
			}
			add_tech_progress = {
				tech = tech_nanite_transmutation
				progress = 0.4
			}
		}
		event_target:emex_seeder_sp1_target = {
			add_deposit = d_nanites_deposit_2
		}

		remove_country_flag = emex_seeded_ongoing_branch
		set_country_flag = emex_seeded_chain1_done
		add_event_chain_counter = {
			event_chain = emex_seeded_annals
			counter = emex_seeded_knowledge
			amount = 1
		}
		# todo: reenable
		# country_event = {
		# 	id = emex_origin2.10 # Main Gatekeeper
		# 	days = 1800
		# 	random = 1800
		# }
	}
}

## Path 2 - Familiar Signal
# Start SP Complete
ship_event = {
	id = emex_origin2.200
	title = "emex_origin2.200.name"
	desc = "emex_origin2.200.desc"
	picture = GFX_evt_gas_giant
	location = fromfrom
	
	is_triggered_only = yes
	
	trigger = {
		owner = { has_origin = origin_emex_seeded_evolution }
	}

	immediate = {
		fromfrom = {
			save_event_target_as = emex_seeder_sp2_target
		}
	}
	
	option = {
		name = "emex_origin2.200.1"
		fromfrom = {
			create_archaeological_site = emex_seeder_sp2_digsite
		}
	}
}
# Digsite - I
fleet_event = { 
	id = emex_origin2.201
	title = "emex_origin2.201.name"
	desc = emex_origin2.201.desc
	picture = GFX_evt_mining_station
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = emex_origin2.201.1 # Path A
		small_artifact_reward = yes
		owner = {
			set_country_flag = emex_seeder_sp2_pathA
		}
	}
	option = {
		name = emex_origin2.201.2 # Path B
		small_artifact_reward = yes
		from = {
			add_stage_clues = -2
		}
		owner = {
			set_country_flag = emex_seeder_sp2_pathB
		}
	}
}
# Digsite - II
fleet_event = { 
	id = emex_origin2.202
	title = "emex_origin2.202.name"
	desc = {
		trigger = {
			owner = { has_country_flag = emex_seeder_sp2_pathA }
		}
		text = "emex_origin2.202.A.desc"
	}
	desc = {
		trigger = {
			owner = { has_country_flag = emex_seeder_sp2_pathB }
		}
		text = "emex_origin2.202.B.desc"
	}
	picture = {
		trigger = {
			owner = { has_country_flag = emex_seeder_sp2_pathA }
		}
		picture = GFX_evt_cosmic_storms_calibration
	}
	picture = {
		trigger = {
			owner = { has_country_flag = emex_seeder_sp2_pathB }
		}
		picture = GFX_evt_sabotaged_ship
	}
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = emex_origin2.202.1
		trigger = {
			owner = {
				has_country_flag = emex_seeder_sp2_pathA
			}
		}
		owner = {
			add_resource = {
				rare_crystals = 2000
			}
		}
		large_artifact_reward = yes
	}
	option = {
		name = emex_origin2.202.2
		trigger = {
			owner = {
				has_country_flag = emex_seeder_sp2_pathB
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = alloys
				value = 10
				min = 1500
				max = 5000
			}
			add_monthly_resource_mult = {
				resource = minerals
				value = 12
				min = 3000
				max = 5000
			}
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}
}
# Digsite - III
fleet_event = { 
	id = emex_origin2.203
	title = "emex_origin2.203.name"
	desc = emex_origin2.203.desc
	picture = GFX_evt_clones
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = emex_origin2.203.1
		small_artifact_reward = yes
	}
}
# Digsite - IV
fleet_event = { 
	id = emex_origin2.204
	title = "emex_origin2.204.name"
	desc = emex_origin2.204.desc
	picture = GFX_evt_rare_tech_cache
	location = from

	archaeology = yes

	is_triggered_only = yes

	immediate = {
		from = { set_site_progress_locked = yes }
	}

	after = {
		from = { set_site_progress_locked = no }
	}

	option = {
		name = emex_origin2.204.1
		small_artifact_reward = yes

		from.planet = {
			add_deposit = d_physics_4
			add_deposit = d_society_4
			add_deposit = d_engineering_4
		}
		
		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = @tier4unityreward
				min = @tier4unitymin
				max = @tier4unitymax
			}
	
			remove_country_flag = emex_seeded_ongoing_branch
			set_country_flag = emex_seeded_chain2_done
			add_event_chain_counter = {
				event_chain = emex_seeded_annals
				counter = emex_seeded_knowledge
				amount = 1
			}
			# todo: reenable
			# country_event = {
			# 	id = emex_origin2.10 # Main Gatekeeper
			# 	days = 1800
			# 	random = 1800
			# }
		}
	}
}