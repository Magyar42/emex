generate_flistonu_primitives_on_planet = {
	create_flistonu_species = yes
	create_flistonu_primitive_empire = yes
	setup_flistonu_primitive_planet = yes
}

create_flistonu_species = {
	create_species = {
		name = "Flistonu"
		plural = "Flistonu"
		class = AVI
		portrait = avi13
		namelist = "AVI2"
		traits = {
			trait = "trait_limited_regeneration"
			trait = "trait_social_pheromones"
			trait = "trait_bioadaptability"
			trait = "trait_sedentary"
			trait = "trait_cybernetic"
			trait = "trait_pc_continental_preference"
		}
		effect = { save_global_event_target_as = flistonu_species }
	}
}

create_flistonu_primitive_empire = {
	create_country = {
		name = "Flistonu Democratic Republic"
		authority = auth_democratic
		civics = {
			civic = civic_beacon_of_liberty
			civic = civic_meritocracy
		}
		species = event_target:flistonu_species
		ethos = {
			ethic = "ethic_fanatic_egalitarian"
			ethic = "ethic_materialist"
		}
		flag = {
			icon = {
				category="zoological"
				file="flag_zoological_20.dds"
			}
			background = {
				category="backgrounds"
				file="new_dawn.dds"
			}
			colors = {
				"indigo"
				"light_green"
				"null"
				"null"
			}
		}
		type = primitive
	}
	last_created_country = {
		save_global_event_target_as = flistonu_portrait
		set_graphical_culture = industrial_01
		set_country_flag = early_space_age
		set_country_flag = flistonu_primitives
		set_pre_ftl_age = early_space_age
		change_country_flag = {
			icon = {
				category="zoological"
				file="flag_zoological_20.dds"
			}
			background = {
				category="backgrounds"
				file="new_dawn.dds"
			}
			colors = {
				"indigo"
				"light_green"
				"null"
				"null"
			}
		}
	}
}

setup_flistonu_primitive_planet = {
	set_owner = last_created_country
	set_capital = yes
	
	last_created_country = {
		if = {
			limit = { has_country_flag = early_space_age }
			prev = {
				while = {
					count = 30
					create_pop = {
						species = last_created
					}					
				}
				add_building = building_primitive_factory
				add_building = building_primitive_mine
				add_building = building_primitive_power_plant
				add_building = building_primitive_farm
				add_building = building_research_lab_1
				add_building = building_luxury_residence
				add_building = building_primitive_capital
				remove_building = building_colony_shelter
			}
		}
	}
}

generate_master_ai_v1 = {
	create_master_ai_species_v2 = yes
	create_master_ai_empire = yes
}

generate_master_ai_v2 = {
	create_master_ai_species_v2 = yes
	create_master_ai_empire_and_inital_fleet = yes
}

create_master_ai_empire = {
	create_country = {
			name = "The Master Intelligence"
			species = event_target:master_ai_species
			flag = { 
				icon = {
					category = "emex"
					file = "flag_tma.dds"
				}
				background = {
					category = "backgrounds"
					file = "flag_BG_3.dds"
				}
				colors = {
					"orange"
					"dark_grey"
					"null"
					"null"
				}
			}
			type = master_ai_country
			name_list = ROOT
			auto_delete = no
			effect = {
				set_country_flag = master_ai_country
				save_global_event_target_as = master_ai_country
				establish_communications_no_message = root
				#establish_contact = { who = root location = root.capital_scope }
			}
	}
}

create_master_ai_empire_and_inital_fleet = {
	create_country = {
			name = "The Master Intelligence"
			species = event_target:master_ai_species
			flag = { 
				icon = {
					category = "emex"
					file = "flag_tma.dds"
				}
				background = {
					category = "backgrounds"
					file = "flag_BG_3.dds"
				}
				colors = {
					"orange"
					"dark_grey"
					"null"
					"null"
				}
			}
			type = master_ai_country
			name_list = ROOT
			auto_delete = no
			effect = {
				set_country_flag = master_ai_country
				save_global_event_target_as = master_ai_country
				establish_communications_no_message = root
				establish_contact = { who = root location = root.capital_scope }
				create_fleet = {
					name = "The Prime Hunter"
					effect = {
						set_owner = prev
						create_ship_design = {
							design = "NAME_Ascendant_Neural_Network"
						}
						create_ship = {
							name = "Prime Hunter"
							design = last_created_design
							effect = {
								set_ship_flag = master_ai_main_ship
								save_global_event_target_as = master_ai_main_ship
							}
						}
						set_location = event_target:master_ai_origin #change when done
						set_fleet_stance = aggressive
						set_aggro_range_measure_from = return_point
						set_aggro_range = 150
						queue_actions = {
							repeat = {
								wait = {
									duration = 25
								}
							}
						}
					}
				}
			}
	}
}

create_master_ai_species_v2 = {
	create_species = {
		name = "Hyperintelligentoid"
		plural = "Hyperintelligentoids"
		class = MACHINE
		portrait = sd_rep_robot
		namelist = "REP1"
		traits = random
		immortal = yes
	}
	last_created_species = {
		set_species_flag = master_ai_species
		save_global_event_target_as = master_ai_species
	}
}

check_tma_intelligence_level = { # changes up to 200
	random_list = {
			20 = { #intelligence stays same
				modifier = {
					factor = 0.5
					check_variable = {
						which = tma_intelligence
						value > 75
					}
				}
				modifier = {
					factor = 0
					check_variable = {
						which = tma_intelligence
						value > 100
					}
				}
				# nothing
			}
			50 = { #intelligence +1
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 100
					}
				}
				modifier = {
					factor = 0
					check_variable = {
						which = tma_intelligence
						value > 200
					}
				}
				change_variable = {
					which = tma_intelligence
					value = 1
				}
			}
			25 = { #intelligence +2
				modifier = {
					factor = 5
					check_variable = {
						which = tma_intelligence
						value > 75
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 100
					}
				}
				modifier = {
					factor = 0
					check_variable = {
						which = tma_intelligence
						value > 200
					}
				}
				change_variable = {
					which = tma_intelligence
					value = 2
				}
			}
			10 = { #intelligence +3
				modifier = {
					factor = 3
					check_variable = {
						which = tma_intelligence
						value > 75
					}
				}
				modifier = {
					factor = 5
					check_variable = {
						which = tma_intelligence
						value > 100
					}
				}
				modifier = {
					factor = 10
					check_variable = {
						which = tma_intelligence
						value > 200
					}
				}
				change_variable = {
					which = tma_intelligence
					value = 3
				}
			}
			1 = { #intelligence +4
				modifier = {
					factor = 5
					check_variable = {
						which = tma_intelligence
						value > 75
					}
				}
				modifier = {
					factor = 6
					check_variable = {
						which = tma_intelligence
						value > 100
					}
				}
				modifier = {
					factor = 10
					check_variable = {
						which = tma_intelligence
						value > 200
					}
				}
				change_variable = {
					which = tma_intelligence
					value = 4
				}
			}
			1 = { #intelligence +5
				modifier = {
					factor = 10
					check_variable = {
						which = tma_intelligence
						value > 75
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 100
					}
				}
				modifier = {
					factor = 4
					check_variable = {
						which = tma_intelligence
						value > 200
					}
				}
				change_variable = {
					which = tma_intelligence
					value = 5
				}
			}
		}
}

tma_boost_research_effect = {
	random_list = {
		# TIER 1
		20 = {
			modifier = {
				factor = 0.25
				check_variable = {
					which = tma_intelligence
					value > 49
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					which = tma_intelligence
					value > 99
				}
			}
			add_modifier = {
				modifier = "tma_option1_effect1a"
				days = 1440
			}
		}
		20 = {
			modifier = {
				factor = 0.25
				check_variable = {
					which = tma_intelligence
					value > 49
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					which = tma_intelligence
					value > 99
				}
			}
			add_modifier = {
				modifier = "tma_option1_effect2a"
				days = 1440
			}
		}
		20 = {
			modifier = {
				factor = 0.25
				check_variable = {
					which = tma_intelligence
					value > 49
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					which = tma_intelligence
					value > 99
				}
			}
			add_modifier = {
				modifier = "tma_option1_effect3a"
				days = 1440
			}
		}
		20 = {
			modifier = {
				factor = 0.25
				check_variable = {
					which = tma_intelligence
					value > 49
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					which = tma_intelligence
					value > 99
				}
			}
			add_modifier = {
				modifier = "tma_option1_effect4a"
				days = 1440
			}
		}
		20 = {
			modifier = {
				factor = 0.25
				check_variable = {
					which = tma_intelligence
					value > 49
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					which = tma_intelligence
					value > 99
				}
			}
			add_modifier = {
				modifier = "tma_option1_effect5a"
				days = 1440
			}
		}
		# TIER 2
		1 = {
			modifier = {
				factor = 10
				check_variable = {
					which = tma_intelligence
					value > 24
				}
			}
			modifier = {
				factor = 2
				check_variable = {
					which = tma_intelligence
					value > 74
				}
			}
			modifier = {
				factor = 0.5
				check_variable = {
					which = tma_intelligence
					value > 149
				}
			}
			#restrictions
			modifier = {
				factor = 0.10
				has_global_flag = tma_large_restrictions
			}
			modifier = {
				factor = 0.35
				has_global_flag = tma_decent_restrictions
			}
			modifier = {
				factor = 0.80
				has_global_flag = tma_few_restrictions
			}
			add_modifier = {
				modifier = "tma_option1_effect1b"
				days = 1440
			}
		}
		1 = {
			modifier = {
				factor = 10
				check_variable = {
					which = tma_intelligence
					value > 24
				}
			}
			modifier = {
				factor = 2
				check_variable = {
					which = tma_intelligence
					value > 74
				}
			}
			modifier = {
				factor = 0.5
				check_variable = {
					which = tma_intelligence
					value > 149
				}
			}
			#restrictions
			modifier = {
				factor = 0.10
				has_global_flag = tma_large_restrictions
			}
			modifier = {
				factor = 0.35
				has_global_flag = tma_decent_restrictions
			}
			modifier = {
				factor = 0.80
				has_global_flag = tma_few_restrictions
			}
			add_modifier = {
				modifier = "tma_option1_effect2b"
				days = 1440
			}
		}
		1 = {
			modifier = {
				factor = 10
				check_variable = {
					which = tma_intelligence
					value > 24
				}
			}
			modifier = {
				factor = 2
				check_variable = {
					which = tma_intelligence
					value > 74
				}
			}
			modifier = {
				factor = 0.5
				check_variable = {
					which = tma_intelligence
					value > 149
				}
			}
			#restrictions
			modifier = {
				factor = 0.10
				has_global_flag = tma_large_restrictions
			}
			modifier = {
				factor = 0.35
				has_global_flag = tma_decent_restrictions
			}
			modifier = {
				factor = 0.80
				has_global_flag = tma_few_restrictions
			}
			add_modifier = {
				modifier = "tma_option1_effect3b"
				days = 1440
			}
		}
		1 = {
			modifier = {
				factor = 10
				check_variable = {
					which = tma_intelligence
					value > 24
				}
			}
			modifier = {
				factor = 2
				check_variable = {
					which = tma_intelligence
					value > 74
				}
			}
			modifier = {
				factor = 0.5
				check_variable = {
					which = tma_intelligence
					value > 149
				}
			}
			#restrictions
			modifier = {
				factor = 0.10
				has_global_flag = tma_large_restrictions
			}
			modifier = {
				factor = 0.35
				has_global_flag = tma_decent_restrictions
			}
			modifier = {
				factor = 0.80
				has_global_flag = tma_few_restrictions
			}
			add_modifier = {
				modifier = "tma_option1_effect4b"
				days = 1440
			}
		}
		1 = {
			modifier = {
				factor = 10
				check_variable = {
					which = tma_intelligence
					value > 24
				}
			}
			modifier = {
				factor = 2
				check_variable = {
					which = tma_intelligence
					value > 74
				}
			}
			modifier = {
				factor = 0.5
				check_variable = {
					which = tma_intelligence
					value > 149
				}
			}
			#restrictions
			modifier = {
				factor = 0.10
				has_global_flag = tma_large_restrictions
			}
			modifier = {
				factor = 0.35
				has_global_flag = tma_decent_restrictions
			}
			modifier = {
				factor = 0.80
				has_global_flag = tma_few_restrictions
			}
			add_modifier = {
				modifier = "tma_option1_effect5b"
				days = 1440
			}
		}
		# TIER 3
		1 = {
			modifier = {
				factor = 10
				check_variable = {
					which = tma_intelligence
					value > 74
				}
			}
			modifier = {
				factor = 2
				check_variable = {
					which = tma_intelligence
					value > 124
				}
			}
			modifier = {
				factor = 5
				check_variable = {
					which = tma_intelligence
					value > 199
				}
			}
			#restrictions
			modifier = {
				factor = 0
				has_global_flag = tma_large_restrictions
			}
			modifier = {
				factor = 0.25
				has_global_flag = tma_decent_restrictions
			}
			modifier = {
				factor = 0.75
				has_global_flag = tma_few_restrictions
			}
			add_modifier = {
				modifier = "tma_option1_effect1c"
				days = 1440
			}
		}
		1 = {
			modifier = {
				factor = 10
				check_variable = {
					which = tma_intelligence
					value > 74
				}
			}
			modifier = {
				factor = 2
				check_variable = {
					which = tma_intelligence
					value > 124
				}
			}
			modifier = {
				factor = 5
				check_variable = {
					which = tma_intelligence
					value > 199
				}
			}
			#restrictions
			modifier = {
				factor = 0
				has_global_flag = tma_large_restrictions
			}
			modifier = {
				factor = 0.25
				has_global_flag = tma_decent_restrictions
			}
			modifier = {
				factor = 0.75
				has_global_flag = tma_few_restrictions
			}
			add_modifier = {
				modifier = "tma_option1_effect2c"
				days = 1440
			}
		}
		1 = {
			modifier = {
				factor = 10
				check_variable = {
					which = tma_intelligence
					value > 74
				}
			}
			modifier = {
				factor = 2
				check_variable = {
					which = tma_intelligence
					value > 124
				}
			}
			modifier = {
				factor = 5
				check_variable = {
					which = tma_intelligence
					value > 199
				}
			}
			#restrictions
			modifier = {
				factor = 0
				has_global_flag = tma_large_restrictions
			}
			modifier = {
				factor = 0.25
				has_global_flag = tma_decent_restrictions
			}
			modifier = {
				factor = 0.75
				has_global_flag = tma_few_restrictions
			}
			add_modifier = {
				modifier = "tma_option1_effect3c"
				days = 1440
			}
		}
		1 = {
			modifier = {
				factor = 10
				check_variable = {
					which = tma_intelligence
					value > 74
				}
			}
			modifier = {
				factor = 2
				check_variable = {
					which = tma_intelligence
					value > 124
				}
			}
			modifier = {
				factor = 5
				check_variable = {
					which = tma_intelligence
					value > 199
				}
			}
			#restrictions
			modifier = {
				factor = 0
				has_global_flag = tma_large_restrictions
			}
			modifier = {
				factor = 0.25
				has_global_flag = tma_decent_restrictions
			}
			modifier = {
				factor = 0.75
				has_global_flag = tma_few_restrictions
			}
			add_modifier = {
				modifier = "tma_option1_effect4c"
				days = 1440
			}
		}
		1 = {
			modifier = {
				factor = 10
				check_variable = {
					which = tma_intelligence
					value > 74
				}
			}
			modifier = {
				factor = 2
				check_variable = {
					which = tma_intelligence
					value > 124
				}
			}
			modifier = {
				factor = 5
				check_variable = {
					which = tma_intelligence
					value > 199
				}
			}
			#restrictions
			modifier = {
				factor = 0
				has_global_flag = tma_large_restrictions
			}
			modifier = {
				factor = 0.25
				has_global_flag = tma_decent_restrictions
			}
			modifier = {
				factor = 0.75
				has_global_flag = tma_few_restrictions
			}
			add_modifier = {
				modifier = "tma_option1_effect5c"
				days = 1440
			}
		}
	}
}

tma_research_tech_effect = {
	if = {
		limit = {
			check_variable = {
				which = tma_intelligence
				value < 75
			}
		}
		add_random_research_option = {
			add_progress = 0.50
			area = engineering
			ignore_prereqs = no
			fail_effects = {
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier1researchreward
					min = @tier1researchmin
					max = @tier1researchmax
				}
			}
		}
		add_random_research_option = {
			add_progress = 0.50
			area = society
			ignore_prereqs = no
			fail_effects = {
				add_monthly_resource_mult = {
					resource = society_research
					value = @tier1researchreward
					min = @tier1researchmin
					max = @tier1researchmax
				}
			}
		}
		add_random_research_option = {
			add_progress = 0.50
			area = physics
			ignore_prereqs = no
			fail_effects = {
				add_monthly_resource_mult = {
					resource = physics_research
					value = @tier1researchreward
					min = @tier1researchmin
					max = @tier1researchmax
				}
			}
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = tma_intelligence
				value > 74
			}
			check_variable = {
				which = tma_intelligence
				value < 150
			}
			NOT = { has_global_flag = tma_large_restrictions }
		}
		add_random_research_option = {
			add_progress = 0.75
			area = engineering
			ignore_prereqs = no
			fail_effects = {
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
				}
			}
		}
		add_random_research_option = {
			add_progress = 0.75
			area = society
			ignore_prereqs = no
			fail_effects = {
				add_monthly_resource_mult = {
					resource = society_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
				}
			}
		}
		add_random_research_option = {
			add_progress = 0.75
			area = physics
			ignore_prereqs = no
			fail_effects = {
				add_monthly_resource_mult = {
					resource = physics_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
				}
			}
		}
	}
	else_if = {
		limit = {
			check_variable = {
				which = tma_intelligence
				value > 149
			}
			NOT = { has_global_flag = tma_large_restrictions }
			NOT = { has_global_flag = tma_decent_restrictions }
		}
		add_random_research_option = {
			add_progress = 0.90
			area = engineering
			ignore_prereqs = no
			fail_effects = {
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier3researchreward
					min = @tier3researchmin
					max = @tier3researchmax
				}
			}
		}
		add_random_research_option = {
			add_progress = 0.90
			area = society
			ignore_prereqs = no
			fail_effects = {
				add_monthly_resource_mult = {
					resource = society_research
					value = @tier3researchreward
					min = @tier3researchmin
					max = @tier3researchmax
				}
			}
		}
		add_random_research_option = {
			add_progress = 0.90
			area = physics
			ignore_prereqs = no
			fail_effects = {
				add_monthly_resource_mult = {
					resource = physics_research
					value = @tier3researchreward
					min = @tier3researchmin
					max = @tier3researchmax
				}
			}
		}
	}
	else = {
		add_monthly_resource_mult = {
			resource = engineering_research
			value = @tier3researchreward
			min = @tier3researchmin
			max = @tier3researchmax
		}
		add_monthly_resource_mult = {
			resource = society_research
			value = @tier3researchreward
			min = @tier3researchmin
			max = @tier3researchmax
		}
		add_monthly_resource_mult = {
			resource = physics_research
			value = @tier3researchreward
			min = @tier3researchmin
			max = @tier3researchmax
		}
	}
}

tma_analyse_worlds_effect = {
	random_planet_within_border = {
		limit = { 
				habitable_planet = no
				is_artificial = no
				NOR = {
					is_planet_class = pc_ringworld_habitable_damaged
					is_planet_class = pc_ringworld_tech_damaged
					is_planet_class = pc_ringworld_tech
					is_planet_class = pc_ringworld_seam
					is_planet_class = pc_ringworld_seam_damaged
				}
				# check that the random list won't come up empty
				OR = {
					energy_candidate = yes
					mineral_candidate = yes
					research_candidate = yes
					alloy_candidate = yes
					exotic_gas_candidate = yes
					rare_crystal_candidate = yes
					volatile_motes_candidate = yes
					ROOT = { is_gestalt = no }
				}
			}
		save_global_event_target_as = tma_analysed_world
	}
	random_list = {

			# Energy
			10 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { energy_candidate = no }
				}
				modifier = {
					factor = 0.25
					check_variable = {
						which = tma_intelligence
						value > 49
					}
				}
				modifier = {
					factor = 0
					check_variable = {
						which = tma_intelligence
						value > 99
					}
				}
				event_target:tma_analysed_world = { add_deposit = d_energy_5 }
			}
			5 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { energy_candidate = no }
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 24
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 0.5
					check_variable = {
						which = tma_intelligence
						value > 149
					}
				}
				#restrictions
				modifier = {
					factor = 0.10
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.35
					has_global_flag = tma_decent_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_energy_7 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { energy_candidate = no }
				}
				modifier = {
					factor = 10
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 124
					}
				}
				modifier = {
					factor = 5
					check_variable = {
						which = tma_intelligence
						value > 199
					}
				}
				#restrictions
				modifier = {
					factor = 0
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.25
					has_global_flag = tma_decent_restrictions
				}
				modifier = {
					factor = 0.75
					has_global_flag = tma_few_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_energy_9 }
			}

			# Minerals
			10 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { mineral_candidate = no }
				}
				modifier = {
					factor = 0.25
					check_variable = {
						which = tma_intelligence
						value > 49
					}
				}
				modifier = {
					factor = 0
					check_variable = {
						which = tma_intelligence
						value > 99
					}
				}
				event_target:tma_analysed_world = { add_deposit = d_minerals_5 }
			}
			5 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { mineral_candidate = no }
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 24
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 0.5
					check_variable = {
						which = tma_intelligence
						value > 149
					}
				}
				#restrictions
				modifier = {
					factor = 0.10
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.35
					has_global_flag = tma_decent_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_minerals_7 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { mineral_candidate = no }
				}
				modifier = {
					factor = 10
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 124
					}
				}
				modifier = {
					factor = 5
					check_variable = {
						which = tma_intelligence
						value > 199
					}
				}
				#restrictions
				modifier = {
					factor = 0
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.25
					has_global_flag = tma_decent_restrictions
				}
				modifier = {
					factor = 0.75
					has_global_flag = tma_few_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_minerals_9 }
			}

			# Physics
			10 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { research_candidate = no }
				}
				modifier = {
					factor = 0.25
					check_variable = {
						which = tma_intelligence
						value > 49
					}
				}
				modifier = {
					factor = 0
					check_variable = {
						which = tma_intelligence
						value > 99
					}
				}
				event_target:tma_analysed_world = { add_deposit = d_physics_5 }
			}
			5 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { research_candidate = no }
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 24
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 0.5
					check_variable = {
						which = tma_intelligence
						value > 149
					}
				}
				#restrictions
				modifier = {
					factor = 0.10
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.35
					has_global_flag = tma_decent_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_physics_7 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { research_candidate = no }
				}
				modifier = {
					factor = 10
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 124
					}
				}
				modifier = {
					factor = 5
					check_variable = {
						which = tma_intelligence
						value > 199
					}
				}
				#restrictions
				modifier = {
					factor = 0
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.25
					has_global_flag = tma_decent_restrictions
				}
				modifier = {
					factor = 0.75
					has_global_flag = tma_few_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_physics_9 }
			}

			# Society
			10 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { research_candidate = no }
				}
				modifier = {
					factor = 0.25
					check_variable = {
						which = tma_intelligence
						value > 49
					}
				}
				modifier = {
					factor = 0
					check_variable = {
						which = tma_intelligence
						value > 99
					}
				}
				event_target:tma_analysed_world = { add_deposit = d_society_5 }
			}
			5 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { research_candidate = no }
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 24
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 0.5
					check_variable = {
						which = tma_intelligence
						value > 149
					}
				}
				#restrictions
				modifier = {
					factor = 0.10
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.35
					has_global_flag = tma_decent_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_society_7 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { research_candidate = no }
				}
				modifier = {
					factor = 10
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 124
					}
				}
				modifier = {
					factor = 5
					check_variable = {
						which = tma_intelligence
						value > 199
					}
				}
				#restrictions
				modifier = {
					factor = 0
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.25
					has_global_flag = tma_decent_restrictions
				}
				modifier = {
					factor = 0.75
					has_global_flag = tma_few_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_society_9 }
			}

			# Engineering
			10 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { research_candidate = no }
				}
				modifier = {
					factor = 0.25
					check_variable = {
						which = tma_intelligence
						value > 49
					}
				}
				modifier = {
					factor = 0
					check_variable = {
						which = tma_intelligence
						value > 99
					}
				}
				event_target:tma_analysed_world = { add_deposit = d_engineering_5 }
			}
			5 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { research_candidate = no }
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 24
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 0.5
					check_variable = {
						which = tma_intelligence
						value > 149
					}
				}
				#restrictions
				modifier = {
					factor = 0.10
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.35
					has_global_flag = tma_decent_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_engineering_7 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { research_candidate = no }
				}
				modifier = {
					factor = 10
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 124
					}
				}
				modifier = {
					factor = 5
					check_variable = {
						which = tma_intelligence
						value > 199
					}
				}
				#restrictions
				modifier = {
					factor = 0
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.25
					has_global_flag = tma_decent_restrictions
				}
				modifier = {
					factor = 0.75
					has_global_flag = tma_few_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_engineering_9 }
			}

			# Trade
			10 = {
				modifier = {
					factor = 0
					is_gestalt = yes
				}
				modifier = {
					factor = 0.25
					check_variable = {
						which = tma_intelligence
						value > 49
					}
				}
				modifier = {
					factor = 0
					check_variable = {
						which = tma_intelligence
						value > 99
					}
				}
				event_target:tma_analysed_world = { add_deposit = d_trade_value_5 }
			}
			5 = {
				modifier = {
					factor = 0
					is_gestalt = yes
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 24
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 0.5
					check_variable = {
						which = tma_intelligence
						value > 149
					}
				}
				#restrictions
				modifier = {
					factor = 0.10
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.35
					has_global_flag = tma_decent_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_trade_value_7 }
			}
			1 = {
				modifier = {
					factor = 0
					is_gestalt = yes
				}
				modifier = {
					factor = 10
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 124
					}
				}
				modifier = {
					factor = 5
					check_variable = {
						which = tma_intelligence
						value > 199
					}
				}
				#restrictions
				modifier = {
					factor = 0
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.25
					has_global_flag = tma_decent_restrictions
				}
				modifier = {
					factor = 0.75
					has_global_flag = tma_few_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_trade_value_9 }
			}

			# Alloys
			10 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { alloy_candidate = no }
				}
				modifier = {
					factor = 0.25
					check_variable = {
						which = tma_intelligence
						value > 49
					}
				}
				modifier = {
					factor = 0
					check_variable = {
						which = tma_intelligence
						value > 99
					}
				}
				event_target:tma_analysed_world = { add_deposit = d_alloys_3 }
			}
			5 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { alloy_candidate = no }
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 24
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 0.5
					check_variable = {
						which = tma_intelligence
						value > 149
					}
				}
				#restrictions
				modifier = {
					factor = 0.10
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.35
					has_global_flag = tma_decent_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_alloys_4 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { alloy_candidate = no }
				}
				modifier = {
					factor = 10
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 124
					}
				}
				modifier = {
					factor = 5
					check_variable = {
						which = tma_intelligence
						value > 199
					}
				}
				#restrictions
				modifier = {
					factor = 0
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.25
					has_global_flag = tma_decent_restrictions
				}
				modifier = {
					factor = 0.75
					has_global_flag = tma_few_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_alloys_5 }
			}

			# Exotic Gas
			10 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { exotic_gas_candidate = no }
				}
				modifier = {
					factor = 0.25
					check_variable = {
						which = tma_intelligence
						value > 49
					}
				}
				modifier = {
					factor = 0
					check_variable = {
						which = tma_intelligence
						value > 99
					}
				}
				event_target:tma_analysed_world = { add_deposit = d_exotic_gases_3 }
			}
			5 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { exotic_gas_candidate = no }
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 24
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 0.5
					check_variable = {
						which = tma_intelligence
						value > 149
					}
				}
				#restrictions
				modifier = {
					factor = 0.10
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.35
					has_global_flag = tma_decent_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_exotic_gases_4 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { exotic_gas_candidate = no }
				}
				modifier = {
					factor = 10
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 124
					}
				}
				modifier = {
					factor = 5
					check_variable = {
						which = tma_intelligence
						value > 199
					}
				}
				#restrictions
				modifier = {
					factor = 0
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.25
					has_global_flag = tma_decent_restrictions
				}
				modifier = {
					factor = 0.75
					has_global_flag = tma_few_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_exotic_gases_5 }
			}

			# Rare Crystals
			10 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { rare_crystal_candidate = no }
				}
				modifier = {
					factor = 0.25
					check_variable = {
						which = tma_intelligence
						value > 49
					}
				}
				modifier = {
					factor = 0
					check_variable = {
						which = tma_intelligence
						value > 99
					}
				}
				event_target:tma_analysed_world = { add_deposit = d_rare_crystals_3 }
			}
			5 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { rare_crystal_candidate = no }
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 24
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 0.5
					check_variable = {
						which = tma_intelligence
						value > 149
					}
				}
				#restrictions
				modifier = {
					factor = 0.10
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.35
					has_global_flag = tma_decent_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_rare_crystals_4 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { rare_crystal_candidate = no }
				}
				modifier = {
					factor = 10
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 124
					}
				}
				modifier = {
					factor = 5
					check_variable = {
						which = tma_intelligence
						value > 199
					}
				}
				#restrictions
				modifier = {
					factor = 0
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.25
					has_global_flag = tma_decent_restrictions
				}
				modifier = {
					factor = 0.75
					has_global_flag = tma_few_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_rare_crystals_5 }
			}

			# Volatile Motes
			10 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { volatile_motes_candidate = no }
				}
				modifier = {
					factor = 0.25
					check_variable = {
						which = tma_intelligence
						value > 49
					}
				}
				modifier = {
					factor = 0
					check_variable = {
						which = tma_intelligence
						value > 99
					}
				}
				event_target:tma_analysed_world = { add_deposit = d_volatile_motes_3 }
			}
			5 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { volatile_motes_candidate = no }
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 24
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 0.5
					check_variable = {
						which = tma_intelligence
						value > 149
					}
				}
				#restrictions
				modifier = {
					factor = 0.10
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.35
					has_global_flag = tma_decent_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_volatile_motes_4 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tma_analysed_world = { volatile_motes_candidate = no }
				}
				modifier = {
					factor = 10
					check_variable = {
						which = tma_intelligence
						value > 74
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = tma_intelligence
						value > 124
					}
				}
				modifier = {
					factor = 5
					check_variable = {
						which = tma_intelligence
						value > 199
					}
				}
				#restrictions
				modifier = {
					factor = 0
					has_global_flag = tma_large_restrictions
				}
				modifier = {
					factor = 0.25
					has_global_flag = tma_decent_restrictions
				}
				modifier = {
					factor = 0.75
					has_global_flag = tma_few_restrictions
				}
				event_target:tma_analysed_world = { add_deposit = d_volatile_motes_5 }
			}
	}
}

tma_boost_intelligence_effect = {
	random_list = {
		5 = {
			change_variable = {
				which = tma_intelligence
				value = 10
			}
		}
		5 = {
			change_variable = {
				which = tma_intelligence
				value = 11
			}
		}
		5 = {
			change_variable = {
				which = tma_intelligence
				value = 12
			}
		}
		5 = {
			change_variable = {
				which = tma_intelligence
				value = 13
			}
		}
		5 = {
			change_variable = {
				which = tma_intelligence
				value = 14
			}
		}
		5 = {
			change_variable = {
				which = tma_intelligence
				value = 15
			}
		}
		5 = {
			change_variable = {
				which = tma_intelligence
				value = 16
			}
		}
		5 = {
			change_variable = {
				which = tma_intelligence
				value = 17
			}
		}
		5 = {
			change_variable = {
				which = tma_intelligence
				value = 18
			}
		}
		5 = {
			change_variable = {
				which = tma_intelligence
				value = 19
			}
		}
		5 = {
			change_variable = {
				which = tma_intelligence
				value = 20
			}
		}
		5 = {
			change_variable = {
				which = tma_intelligence
				value = 21
			}
		}
		5 = {
			change_variable = {
				which = tma_intelligence
				value = 22
			}
		}
		5 = {
			change_variable = {
				which = tma_intelligence
				value = 23
			}
		}
		5 = {
			change_variable = {
				which = tma_intelligence
				value = 24
			}
		}
		5 = {
			change_variable = {
				which = tma_intelligence
				value = 25
			}
		}
	}
}

export_resource_stockpiles_bok = {
	export_resource_stockpile_to_variable = {
		resource = energy
		variable = bok_energy_amount
	}
	export_resource_stockpile_to_variable = {
		resource = minerals
		variable = bok_minerals_amount
	}
	export_resource_stockpile_to_variable = {
		resource = food
		variable = bok_food_amount
	}
	export_resource_stockpile_to_variable = {
		resource = alloys
		variable = bok_alloys_amount
	}
	export_resource_stockpile_to_variable = {
		resource = consumer_goods
		variable = bok_goods_amount
	}
	export_resource_stockpile_to_variable = {
		resource = unity
		variable = bok_unity_amount
	}
	export_resource_stockpile_to_variable = {
		resource = influence
		variable = bok_influence_amount
	}
}

import_resource_stockpiles_bok = {
	add_resource = {
		energy = 1
		mult = bok_energy_amount
	}
	add_resource = {
		minerals = 1
		mult = bok_minerals_amount
	}
	add_resource = {
		food = 1
		mult = bok_food_amount
	}
	add_resource = {
		alloys = 1
		mult = bok_alloys_amount
	}
	add_resource = {
		consumer_goods = 1
		mult = bok_goods_amount
	}
	add_resource = {
		unity = 1
		mult = bok_unity_amount
	}
	add_resource = {
		influence = 1
		mult = bok_influence_amount
	}
}

tma_assign_allowed_traits = {
	# Check to see if trait limit reached
		if = {
			limit = {
				check_variable = {
					which = tma_trait_num
					value <= 2
				}
			}
			# Adding and removing the traits
			if = {
				limit = {
					has_global_flag = tma_trait_content
					NOT = { has_modifier = mod_tma_trait_content }
				}
				add_modifier = {
					modifier = mod_tma_trait_content
				}
				remove_modifier = mod_tma_trait_ambitious
				country_event = { id = emex_msg.3 }
			}
			else_if = {
				limit = {
					has_global_flag = tma_trait_ambitious
					NOT = { has_modifier = mod_tma_trait_ambitious }
				}
				add_modifier = {
					modifier = mod_tma_trait_ambitious
				}
				remove_modifier = mod_tma_trait_content
				country_event = { id = emex_msg.3 }
			}
			else_if = {
				limit = {
					has_global_flag = tma_trait_forgiving
					NOT = { has_modifier = mod_tma_trait_forgiving }
				}
				add_modifier = {
					modifier = mod_tma_trait_forgiving
				}
				remove_modifier = mod_tma_trait_vengeful
				country_event = { id = emex_msg.3 }
			}
			else_if = {
				limit = {
					has_global_flag = tma_trait_vengeful
					NOT = { has_modifier = mod_tma_trait_vengeful }
				}
				add_modifier = {
					modifier = mod_tma_trait_vengeful
				}
				remove_modifier = mod_tma_trait_forgiving
				country_event = { id = emex_msg.3 }
			}
			else_if = {
				limit = {
					has_global_flag = tma_trait_diligent
					NOT = { has_modifier = mod_tma_trait_diligent }
				}
				add_modifier = {
					modifier = mod_tma_trait_diligent
				}
				remove_modifier = mod_tma_trait_lazy
				country_event = { id = emex_msg.3 }
			}
			else_if = {
				limit = {
					has_global_flag = tma_trait_lazy
					NOT = { has_modifier = mod_tma_trait_lazy }
				}
				add_modifier = {
					modifier = mod_tma_trait_lazy
				}
				remove_modifier = mod_tma_trait_diligent
				country_event = { id = emex_msg.3 }
			}
			else_if = {
				limit = {
					has_global_flag = tma_trait_fickle
					NOT = { has_modifier = mod_tma_trait_fickle }
				}
				add_modifier = {
					modifier = mod_tma_trait_fickle
				}
				remove_modifier = mod_tma_trait_steadfast
				country_event = { id = emex_msg.3 }
			}
			else_if = {
				limit = {
					has_global_flag = tma_trait_steadfast
					NOT = { has_modifier = mod_tma_trait_steadfast }
				}
				add_modifier = {
					modifier = mod_tma_trait_steadfast
				}
				remove_modifier = mod_tma_trait_fickle
				country_event = { id = emex_msg.3 }
			}
		}
		else = {
			set_global_flag = tma_traits_set
		}
}

anty_remove_effect = {
	every_owned_planet = {
		remove_deposit = d_anty_colony_deposit
		remove_modifier = anty_startworld
		add_modifier = {
			modifier = anty_removal
			days = 1800
		}
	}
}

machinarchy_aa_reset = {
	remove_planet_flag = machinarchy_aa_food
	remove_planet_flag = machinarchy_aa_energy
	remove_planet_flag = machinarchy_aa_minerals
	remove_planet_flag = machinarchy_aa_alloys
	remove_planet_flag = machinarchy_aa_cgs
}

apply_emex_comvas_bonus = {
	fleet = {
		every_controlled_ship = {
			limit = {
				is_ship_class = shipclass_starbase
			}
			if = {
				limit = { NOT = { has_component = "STARBASE_EMEX_RECON_FIELDS" } }
				starbase = {
					add_starbase_component = {
					 component = "STARBASE_EMEX_RECON_FIELDS"
				    }
				}
			}
		}
	}
}

remove_emex_comvas_bonus = {
	fleet = {
		every_controlled_ship = {
			limit = { is_ship_class = shipclass_starbase }
			if = {
				limit = { has_component = "STARBASE_EMEX_RECON_FIELDS" }
				starbase = {
					remove_starbase_component = {
					 component = "STARBASE_EMEX_RECON_FIELDS"
				    }
				}
			}
		}
	}
}

create_emex_neutral_zone_country = {
	create_country = {
			name = ""
			species = event_target:root.species
			flag = { 
				#icon = {
				#	category = "emex"
				#	file = "flag_tma.dds"
				#}
				background = {
					category = "backgrounds"
					file = "diagonal_stripe.dds"
				}
				colors = {
					"off_white"
					"white"
					"null"
					"null"
				}
			}
			type = emex_neutral_zone
			name_list = ROOT
			auto_delete = no
			effect = {
				set_country_flag = neutral_zone_country
				save_global_event_target_as = neutral_zone_country
				every_country = { establish_communications_no_message = event_target:neutral_zone_country }
			}
	}
}

setup_assimilating_culture_civic = {
	#add_district = district_farming
	#add_district = district_generator
	random_list = {
				25 = {
					create_species = {
						name = random
						class = random_non_machine
						portrait = random
						traits = random
						effect = {
							modify_species = {
								species = this
								ideal_planet_class = prev
							}
						}
					}
					while = {
						count = 3
						create_pop = {
							species = last_created_species
						}
					}
					create_species = {
						name = random
						class = random_non_machine
						portrait = random
						traits = random
						effect = {
							modify_species = {
								species = this
								ideal_planet_class = prev
							}
						}
					}
					while = {
						count = 1
						create_pop = {
							species = last_created_species
						}
					}
				}
				25 = {
					create_species = {
						name = random
						class = random_non_machine
						portrait = random
						traits = random
						effect = {
							modify_species = {
								species = this
								ideal_planet_class = prev
							}
						}
					}
					while = {
						count = 2
						create_pop = {
							species = last_created_species
						}
					}
					create_species = {
						name = random
						class = random_non_machine
						portrait = random
						traits = random
						effect = {
							modify_species = {
								species = this
								ideal_planet_class = prev
							}
						}
					}
					while = {
						count = 2
						create_pop = {
							species = last_created_species
						}
					}
				}
				25 = {
					create_species = {
						name = random
						class = random_non_machine
						portrait = random
						traits = random
						effect = {
							modify_species = {
								species = this
								ideal_planet_class = prev
							}
						}
					}
					while = {
						count = 1
						create_pop = {
							species = last_created_species
						}
					}
					create_species = {
						name = random
						class = random_non_machine
						portrait = random
						traits = random
						effect = {
							modify_species = {
								species = this
								ideal_planet_class = prev
							}
						}
					}
					while = {
						count = 3
						create_pop = {
							species = last_created_species
						}
					}
				}
			}
}

emex_sovereign_nations_setup = {
	set_planet_flag = sn_world
			#Superpower(s)
			random_list = {
				3 = {
					while = {
						count = 2
						add_deposit = d_sn_global_superpower
					}
				}
				7 = {
					add_deposit = d_sn_global_superpower
				}
			}
			#Cooperative nation(s)
			random_list = {
				2 = {
					while = {
						count = 3
						add_deposit = d_sn_cooperative_nation
					}
				}
				5 = {
					while = {
						count = 2
						add_deposit = d_sn_cooperative_nation
					}
				}
				3 = {
					add_deposit = d_sn_cooperative_nation
				}
			}
			#Threatening nation(s)
			random_list = {
				6 = {
					while = {
						count = 2
						add_deposit = d_sn_threatening_state
					}
				}
				3 = {
					add_deposit = d_sn_threatening_state
				}
			}
			#Antagonistic nation(s)
			random_list = {
				3  = {
					while = {
						count = 3
						add_deposit = d_sn_antagonistic_nation
					}
				}
				6 = {
					while = {
						count = 2
						add_deposit = d_sn_antagonistic_nation
					}
				}
				1 = {
					add_deposit = d_sn_antagonistic_nation
				}
			}
			#Neutral nation(s)
			random_list = {
				4  = {
					while = {
						count = 3
						add_deposit = d_sn_neutral_nation
					}
				}
				4 = {
					while = {
						count = 3
						add_deposit = d_sn_neutral_nation
					}
				}
				2 = {
					while = {
						count = 2
						add_deposit = d_sn_neutral_nation
					}
				}
			}
}

emex_sovereign_nations_hive_setup = {
	set_planet_flag = sn_world
	set_planet_flag = sn_world_hive
			#Superpower(s)
			random_list = {
				3 = {
					while = {
						count = 2
						add_deposit = d_sn_global_superpower_h
					}
				}
				7 = {
					add_deposit = d_sn_global_superpower_h
				}
			}
			#Cooperative nation(s)
			random_list = {
				2 = {
					while = {
						count = 3
						add_deposit = d_sn_cooperative_nation_h
					}
				}
				5 = {
					while = {
						count = 2
						add_deposit = d_sn_cooperative_nation_h
					}
				}
				3 = {
					add_deposit = d_sn_cooperative_nation_h
				}
			}
			#Threatening nation(s)
			random_list = {
				6 = {
					while = {
						count = 2
						add_deposit = d_sn_threatening_state_h
					}
				}
				3 = {
					add_deposit = d_sn_threatening_state_h
				}
			}
			#Antagonistic nation(s)
			random_list = {
				3  = {
					while = {
						count = 3
						add_deposit = d_sn_antagonistic_nation_h
					}
				}
				6 = {
					while = {
						count = 2
						add_deposit = d_sn_antagonistic_nation_h
					}
				}
				1 = {
					add_deposit = d_sn_antagonistic_nation_h
				}
			}
			#Neutral nation(s)
			random_list = {
				4  = {
					while = {
						count = 3
						add_deposit = d_sn_neutral_nation_h
					}
				}
				4 = {
					while = {
						count = 3
						add_deposit = d_sn_neutral_nation_h
					}
				}
				2 = {
					while = {
						count = 2
						add_deposit = d_sn_neutral_nation_h
					}
				}
			}
}

apply_symbiosis_pm = {
	remove_symbiosis_pm = yes
	if = {
				limit = {
					is_symbiosis_world_positive = yes
				}
				add_modifier = {
					modifier = symbiosis_perfection
				}
			}
			else_if = {
				limit = {
					is_symbiosis_world_negative = yes
				}
				add_modifier = {
					modifier = symbiosis_pain
				}
			}
			else = {
				add_modifier = {
					modifier = symbiosis_default
					multiplier = value:emex_symbiosis_modifier
				}
			}
}

remove_symbiosis_pm = {
	remove_modifier = symbiosis_default
	remove_modifier = symbiosis_perfection
	remove_modifier = symbiosis_pain
}

apply_caretaker_pm = {
	remove_caretaker_pm = yes
	if = {
				limit = {
					is_caretakers_world_positive = yes
				}
				add_modifier = {
					modifier = caretaker_perfection
				}
			}
			else_if = {
				limit = {
					is_caretakers_world_negative = yes
				}
				add_modifier = {
					modifier = caretaker_pain
				}
			}
			else = {
				add_modifier = {
					modifier = caretaker_default
					multiplier = value:emex_symbiosis_modifier
				}
			}
}

remove_caretaker_pm = {
	remove_modifier = caretaker_default
	remove_modifier = caretaker_perfection
	remove_modifier = caretaker_pain
}

emex_symbiont_presapient_setup = {
	if = {
		limit = { prev = { is_planet_class = pc_nuked } }
		modify_species = {
			species = this
			ideal_planet_class = prev
			add_trait = trait_presapient_irradiated
			effect = {
				set_citizenship_type = { country = root type = citizenship_full cooldown = no }
			}
		}
	}
	else = {
		random_list = {
			10 = {
				modify_species = {
					species = this
					ideal_planet_class = prev
					add_trait = trait_presapient_conservative
				}
			}
			10 = {
				modify_species = {
					species = this
					ideal_planet_class = prev
					add_trait = trait_presapient_earthbound
				}
			}
			10 = {
				modify_species = {
					species = this
					ideal_planet_class = prev
					add_trait = trait_presapient_natural_intellectuals
				}
			}
			10 = {
				modify_species = {
					species = this
					ideal_planet_class = prev
					add_trait = trait_presapient_proles
				}
			}
			10 = {
				modify_species = {
					species = this
					ideal_planet_class = prev
					add_trait = trait_presapient_starborn
				}
			}
			10 = {
				modifier = {
					factor = 0
					has_distar = no
				}
				modify_species = {
					species = this
					ideal_planet_class = prev
					add_trait = trait_presapient_docile_livestock
				}
			}
		}
	}
}

emex_research_resource_gain_effect = {
	# If num of techs of this tier researched is more than the
		# variable's amount, $resource$ is given and variable reset
		if = { #T3
			limit = {
				num_researched_techs_of_tier = {
					tier = 3
					value > sok_t3@root
				}
			}
			add_monthly_resource_mult  = {
				resource = $resource$
				value = $tier_3$
			}
			change_variable = {
				which = sok_t3@root
				value = 1
			}
			# while = {
			# 	limit = {
			# 		check_variable = {
			# 			which = sok@root_t3
			# 			value < t3techs
			# 		}
			# 	}
			# }
		}
		else_if = { #T4
			limit = {
				num_researched_techs_of_tier = {
					tier = 4
					value > sok_t4@root
				}
			}
			add_monthly_resource_mult  = {
				resource = $resource$
				value = $tier_4$
			}
			change_variable = {
				which = sok_t4@root
				value = 1
			}
		}
		else_if = { #T5
			limit = {
				num_researched_techs_of_tier = {
					tier = 5
					value > sok_t5@root
				}
			}
			add_monthly_resource_mult  = {
				resource = $resource$
				value = $tier_5$
			}
			change_variable = {
				which = sok_t5@root
				value = 1
			}
		}

		if = { #RARE
			limit = {
				num_rare_techs > sok_rare@root
			}
			add_monthly_resource_mult  = {
				resource = $resource$
				value = $tier_4$
			}
			change_variable = {
				which = sok_rare@root
				value = 1
			}
		}

		if = { #DANGEROUS
			limit = {
				OR = {
					last_increased_tech = tech_synthetic_workers
					last_increased_tech = tech_combat_computers_3
					last_increased_tech = tech_jump_drive_1
					last_increased_tech = tech_psi_jump_drive_1
				}
			}
			add_monthly_resource_mult  = {
				resource = $resource$
				value = $tier_4$
			}
			change_variable = {
				which = sok_dangerous@root
				value = 1
			}
		}

		# The rare and danger bonuses stack with the tier bonuses
}

emex_pathfinders_effect = {
	while = {
		count = 3
		emex_pathfinders_get_field_effects = yes
	}
}

emex_pathfinders_get_field_effects = {
		random_list = {
			10 = {
				emex_pathfinders_boon = {
					pathfinders_field = computing
				}
				modifier = {
					factor = 0
					has_modifier = emex_pathfinders_boost_computing
				}
			}
			10 = {
				emex_pathfinders_boon = {
					pathfinders_field = field_manipulation
				}
				modifier = {
					factor = 0
					has_modifier = emex_pathfinders_boost_field_manipulation
				}
			}
			10 = {
				emex_pathfinders_boon = {
					pathfinders_field = particles
				}
				modifier = {
					factor = 0
					has_modifier = emex_pathfinders_boost_particles
				}
			}
			10 = {
				emex_pathfinders_boon = {
					pathfinders_field = biology
				}
				modifier = {
					factor = 0
					has_modifier = emex_pathfinders_boost_biology
				}
			}
			10 = {
				emex_pathfinders_boon = {
					pathfinders_field = military_theory
				}
				modifier = {
					factor = 0
					has_modifier = emex_pathfinders_boost_military_theory
				}
			}
			10 = {
				emex_pathfinders_boon = {
					pathfinders_field = new_worlds
				}
				modifier = {
					factor = 0
					has_modifier = emex_pathfinders_boost_new_worlds
				}
			}
			10 = {
				emex_pathfinders_boon = {
					pathfinders_field = statecraft
				}
				modifier = {
					factor = 0
					has_modifier = emex_pathfinders_boost_statecraft
				}
			}
			10 = {
				emex_pathfinders_boon = {
					pathfinders_field = industry
				}
				modifier = {
					factor = 0
					has_modifier = emex_pathfinders_boost_industry
				}
			}
			10 = {
				emex_pathfinders_boon = {
					pathfinders_field = materials
				}
				modifier = {
					factor = 0
					has_modifier = emex_pathfinders_boost_materials
				}
			}
			10 = {
				emex_pathfinders_boon = {
					pathfinders_field = propulsion
				}
				modifier = {
					factor = 0
					has_modifier = emex_pathfinders_boost_propulsion
				}
			}
			10 = {
				emex_pathfinders_boon = {
					pathfinders_field = voidcraft
				}
				modifier = {
					factor = 0
					has_modifier = emex_pathfinders_boost_voidcraft
				}
			}
		}
}

emex_pathfinders_boon = {
	add_modifier = {
		modifier = emex_pathfinders_boost_$pathfinders_field$
		days = 1800
	}
	add_random_research_option = {
		category = $pathfinders_field$
		add_progress = 0.25
		ignore_prereqs = no
		ignore_rare = no
		ignore_insight = yes
	}
}